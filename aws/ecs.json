{
  "Resources": {
    "Cluster": {
      "Type": "AWS::ECS::Cluster",
      "Properties": {
        "CapacityProviders": ["FARGATE"],
        "ClusterName": "SpammerV2Cluster"
      }
    },
    "Task": {
      "Type": "AWS::ECS::TaskDefinition",
      "Properties": {
        "executionRoleArn": "arn:aws:iam::136306849848:role/ecsTaskExecutionRole",
        "containerDefinitions": [
          {
            "cpu": 0,
            "environment": [],
            "image": "leonpatmore/spammer-v2:4c6c21053e3fa16e53c9efbfb33cc01b024b5465",
            "essential": true,
            "name": "leader",
            "PortMappings": [{
              "ContainerPort": 5435
            }]
          },
          {
            "cpu": 0,
            "environment": [
              {
                "Name": "SPAMMER_TYPE",
                "Value": "follower"
              },
              {
                "Name": "SPAMMER_INITIAL_LEADER_SOCKET_ADDRESS",
                "Value": "localhost:5435"
              },
              {
                "Name": "SPAMMER_PORT",
                "Value": "1234"
              }
            ],
            "image": "leonpatmore/spammer-v2:4c6c21053e3fa16e53c9efbfb33cc01b024b5465",
            "essential": true,
            "name": "follower",
            "PortMappings": [{
              "ContainerPort": 1234
            }]
          }
        ],
        "memory": "512",
        "family": "spammer-v2-cluster",
        "requiresCompatibilities": [
          "FARGATE"
        ],
        "networkMode": "awsvpc",
        "cpu": "256"
      }
    },
    "Service": {
      "Type": "AWS::ECS::Service",
      "Properties": {
        "Cluster": {"Fn::GetAtt": ["Cluster", "Arn"]},
        "TaskDefinition": {"Ref": "Task"},
        "LaunchType": "FARGATE",
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "ENABLED",
            "Subnets": ["subnet-c8d3efe6", "subnet-ad19d8e0", "subnet-c8d4e694"]
          }
        }
      }
    }
  }
}
